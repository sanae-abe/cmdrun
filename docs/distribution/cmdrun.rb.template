class Cmdrun < Formula
  desc "Fast, secure, and cross-platform command runner with TOML configuration"
  homepage "https://github.com/sanae-abe/cmdrun"
  version "1.0.0"
  license "MIT OR Apache-2.0"

  # macOSç”¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ãƒã‚¤ãƒŠãƒª
  if Hardware::CPU.arm?
    url "https://github.com/sanae-abe/cmdrun/releases/download/v1.0.0/cmdrun-v1.0.0-aarch64-apple-darwin.tar.gz"
    sha256 "REPLACE_WITH_ARM64_SHA256_AFTER_RELEASE"
  else
    url "https://github.com/sanae-abe/cmdrun/releases/download/v1.0.0/cmdrun-v1.0.0-x86_64-apple-darwin.tar.gz"
    sha256 "REPLACE_WITH_X86_64_SHA256_AFTER_RELEASE"
  end

  def install
    bin.install "cmdrun"

    # ã‚·ã‚§ãƒ«è£œå®Œã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆï¼ˆå°†æ¥çš„ã«å®Ÿè£…ï¼‰
    # generate_completions_from_executable(bin/"cmdrun", "completions")

    # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    doc.install "README.md"
    doc.install "CHANGELOG.md" if File.exist?("CHANGELOG.md")
  end

  def caveats
    <<~EOS
      ğŸ‰ cmdrunãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸï¼

      ğŸ“‹ åˆæœŸè¨­å®š:
        1. è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ: mkdir -p ~/.cmdrun
        2. åˆæœŸåŒ–: cmdrun init
        3. ã‚³ãƒãƒ³ãƒ‰è¿½åŠ : cmdrun add <id> "<command>" "<description>"

      ğŸ’¡ ä½¿ã„æ–¹:
        - ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§: cmdrun list
        - ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ: cmdrun run <id>
        - ãƒ˜ãƒ«ãƒ—: cmdrun --help

      ğŸ“– è©³ç´°: https://github.com/sanae-abe/cmdrun
    EOS
  end

  test do
    # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
    assert_match "cmdrun 1.0.0", shell_output("#{bin}/cmdrun --version")

    # åŸºæœ¬çš„ãªå‹•ä½œç¢ºèª
    system "#{bin}/cmdrun", "list"

    # åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
    ENV["HOME"] = testpath
    system "#{bin}/cmdrun", "init"
    assert_predicate testpath/".cmdrun/commands.toml", :exist?

    # ã‚³ãƒãƒ³ãƒ‰è¿½åŠ ãƒ»å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
    system "#{bin}/cmdrun", "add", "test", "echo hello", "Test command"
    assert_match "test", shell_output("#{bin}/cmdrun list")
  end
end
